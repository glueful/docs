---
title: Query Builder
description: Using the Query Builder in Glueful framework
navigation:
  icon: i-lucide-database
---

# Query Builder

Glueful provides a powerful fluent query builder that simplifies database operations with a clean, chainable API.

## Basic Usage

The query builder allows for expressive, readable database operations:

```php
use Glueful\Database\Connection;
use Glueful\Database\QueryBuilder;

// Initialize query builder
$connection = new Connection();
$db = new QueryBuilder($connection->getPDO(), $connection->getDriver());

// Simple select query
$users = $db->table('users')
    ->select(['id', 'name', 'email'])
    ->where('status', '=', 'active')
    ->orderBy('name', 'ASC')
    ->limit(10)
    ->get();
```

## Select Operations

Retrieve data from database tables with various conditions:

```php
// Basic select with columns
$users = $db->select('users', ['id', 'name', 'email']);

// Select with conditions
$activeUsers = $db->select('users', ['*'], ['status' => 'active']);

// Complex conditions with where methods
$posts = $db->table('posts')
    ->select(['id', 'title', 'created_at'])
    ->where('status', '=', 'published')
    ->where('created_at', '>=', '2025-01-01')
    ->get();

// Selecting with table aliases and join
$data = $db->table('users AS u')
    ->select(['u.id', 'u.name', 'p.title'])
    ->join('posts AS p', 'p.user_id = u.id')
    ->where('u.status', '=', 'active')
    ->get();
```

## Insert Operations

```php
// Single row insert
$id = $db->insert('users', [
    'name' => 'John Doe',
    'email' => 'john@example.com',
    'status' => 'active'
]);

// Bulk insert
$db->insert('users', [
    [
        'name' => 'Jane Smith',
        'email' => 'jane@example.com',
        'status' => 'active'
    ],
    [
        'name' => 'Mike Johnson',
        'email' => 'mike@example.com',
        'status' => 'inactive'
    ]
]);

// Insert and get ID
$userId = $db->table('users')->insertGetId([
    'name' => 'Alice Brown',
    'email' => 'alice@example.com'
]);
```

## Update Operations

```php
// Basic update
$affected = $db->update('users',
    ['status' => 'inactive'],
    ['id' => 5]
);

// Fluent update
$affected = $db->table('users')
    ->where('last_login', '<', date('Y-m-d', strtotime('-1 year')))
    ->update(['status' => 'inactive']);
```

## Delete Operations

```php
// Delete with conditions
$db->delete('users', ['status' => 'inactive']);

// Fluent delete
$db->table('posts')
    ->where('created_at', '<', date('Y-m-d', strtotime('-1 year')))
    ->delete();
```

## Advanced Queries

### Where Clauses

```php
// Multiple conditions
$db->table('users')
    ->where('status', '=', 'active')
    ->where('role', '=', 'admin')
    ->get();

// OR conditions
$db->table('users')
    ->where('status', '=', 'active')
    ->orWhere('role', '=', 'admin')
    ->get();

// Where In
$db->table('users')
    ->whereIn('id', [1, 2, 3, 4])
    ->get();

// Where null/not null
$db->table('users')
    ->whereNull('deleted_at')
    ->get();

$db->table('users')
    ->whereNotNull('last_login')
    ->get();

// Where between
$db->table('posts')
    ->whereBetween('created_at', ['2025-01-01', '2025-12-31'])
    ->get();
```

### Joins

```php
// Inner join
$db->table('users')
    ->join('profiles', 'users.id', '=', 'profiles.user_id')
    ->select(['users.*', 'profiles.biography'])
    ->get();

// Left join
$db->table('users')
    ->leftJoin('posts', 'users.id', '=', 'posts.user_id')
    ->select(['users.name', 'posts.title'])
    ->get();

// Multiple joins
$db->table('orders')
    ->join('users', 'orders.user_id', '=', 'users.id')
    ->leftJoin('products', 'orders.product_id', '=', 'products.id')
    ->select(['orders.id', 'users.name', 'products.title'])
    ->get();
```

### Aggregates

```php
// Count
$count = $db->table('users')->count();

// Max
$maxAge = $db->table('users')->max('age');

// Min
$minAge = $db->table('users')->min('age');

// Average
$avgAge = $db->table('users')->avg('age');

// Sum
$totalSales = $db->table('orders')->sum('amount');
```

### Grouping and Having

```php
// Group by with having
$usersByStatus = $db->table('users')
    ->select(['status', $db->raw('COUNT(*) as user_count')])
    ->groupBy('status')
    ->having('user_count', '>', 10)
    ->get();
```

## Raw Expressions

For complex SQL functions or database-specific features:

```php
// Using raw expressions
$users = $db->table('users')
    ->select([$db->raw('COUNT(*) as user_count')])
    ->where('status', '=', 'active')
    ->get();

// Raw where condition
$db->table('users')
    ->whereRaw('YEAR(created_at) = 2025')
    ->get();
```

## Transactions

Ensure data integrity using transactions:

```php
try {
    $db->beginTransaction();

    // Perform multiple operations
    $userId = $db->table('users')->insertGetId([
        'name' => 'John Doe',
        'email' => 'john@example.com',
    ]);

    $db->table('profiles')->insert([
        'user_id' => $userId,
        'bio' => 'New user bio',
    ]);

    $db->commit();
} catch (\Exception $e) {
    $db->rollBack();
    throw $e;
}
```
