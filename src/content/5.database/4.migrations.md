---
title: Migrations
description: Managing database schema with migrations in Glueful
navigation:
  icon: i-lucide-database
---

# Database Migrations

Glueful provides a robust migration system for managing database schema changes in a version-controlled way.

## Migration Files

Migrations are PHP classes stored in the `database/migrations` directory. Each migration file is named with a numeric prefix for proper ordering, followed by a descriptive name.

```
001_CreateInitialSchema.php
002_SeedInitialData.php
003_CreateScheduledJobsTables.php
004_CreateNotificationSystemTables.php
```

## Creating Migrations

Each migration class must implement the `MigrationInterface` and define both `up()` and `down()` methods:

```php
<?php

use Glueful\Database\Migrations\MigrationInterface;
use Glueful\Database\Schema\SchemaManager;

class CreateProductsTable implements MigrationInterface
{
    /**
     * Execute the migration
     *
     * @param SchemaManager $schema Database schema manager
     */
    public function up(SchemaManager $schema): void
    {
        // Create table with columns
        $schema->createTable('products', [
            'id' => 'BIGINT PRIMARY KEY AUTO_INCREMENT',
            'uuid' => 'CHAR(12) NOT NULL',
            'name' => 'VARCHAR(255) NOT NULL',
            'price' => 'DECIMAL(10,2) NOT NULL',
            'description' => 'TEXT NULL',
            'status' => "VARCHAR(20) NOT NULL DEFAULT 'active'",
            'created_at' => 'TIMESTAMP NOT NULL DEFAULT CURRENT_TIMESTAMP',
            'updated_at' => 'TIMESTAMP NULL ON UPDATE CURRENT_TIMESTAMP'
        ])->addIndex([
            ['type' => 'UNIQUE', 'column' => 'uuid'],
            ['type' => 'INDEX', 'column' => 'status']
        ]);
    }

    /**
     * Reverse the migration
     *
     * @param SchemaManager $schema Database schema manager
     */
    public function down(SchemaManager $schema): void
    {
        // Drop table
        $schema->dropTable('products');
    }

    /**
     * Get migration description
     *
     * @return string Migration description
     */
    public function getDescription(): string
    {
        return 'Creates products table with basic fields';
    }
}
```

## Running Migrations

Migrations can be run using the console command:

```bash
php glueful migrate
```

To run a specific migration:

```bash
php glueful migrate:file 005_CreateProductsTable.php
```

To roll back the most recent batch of migrations:

```bash
php glueful migrate:rollback
```

To roll back a specific number of migrations:

```bash
php glueful migrate:rollback --steps=2
```

## Migration Tracking

Glueful automatically tracks migrations in the `migrations` table:

| id  | migration                         | batch | applied_at          | checksum  | description                        |
| --- | --------------------------------- | ----- | ------------------- | --------- | ---------------------------------- |
| 1   | 001_CreateInitialSchema.php       | 1     | 2025-04-01 10:15:23 | a1b2c3... | Creates initial database schema... |
| 2   | 002_SeedInitialData.php           | 1     | 2025-04-01 10:15:25 | d4e5f6... | Seeds initial user data...         |
| 3   | 003_CreateScheduledJobsTables.php | 2     | 2025-04-10 14:30:45 | g7h8i9... | Creates scheduled jobs tables...   |

## Batches and Rollbacks

Migrations are applied in batches. When rolling back, all migrations in the most recent batch are reverted. This allows for grouping related changes together.

## Using the Migration Manager

The `MigrationManager` class can be used programmatically:

```php
use Glueful\Database\Migrations\MigrationManager;

$manager = new MigrationManager();

// Run all pending migrations
$result = $manager->migrate();

// Get pending migrations
$pendingMigrations = $manager->getPendingMigrations();

// Rollback last batch
$reverted = $manager->rollback();

// Rollback specific number of steps
$reverted = $manager->rollback(3);
```

## Admin Interface

Glueful's admin panel includes a migrations management interface that allows you to:

1. View all migrations and their status
2. See pending migrations
3. Run migrations through the UI
4. Rollback migrations when needed

This provides a convenient way to manage database schema without using the command line.
